# ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Sample IdProvider ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆæ§‹æˆ

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
tests/
â”œâ”€â”€ unit/                   # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ infra/             # ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ modules/           # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ repository/        # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ integration/           # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ auth/             # èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ api/              # API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ security/             # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
â””â”€â”€ README.md

```

## ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

### å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
deno task test
```

### ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
deno task test:watch
```

### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
```bash
deno test tests/unit/infra/jwt.test.ts --allow-all --unstable-kv
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
deno test --coverage=cov_profile --allow-all --unstable-kv
deno coverage cov_profile
```

## ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª

### ğŸ§ª å˜ä½“ãƒ†ã‚¹ãƒˆ (Unit Tests)
- **JWT**: JWT ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆã¨æ¤œè¨¼
- **ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼**: OpenID Connect ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼
- **ID ãƒˆãƒ¼ã‚¯ãƒ³**: ID ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆã¨ã‚¯ãƒ¬ãƒ¼ãƒ å‡¦ç†
- **èªè¨¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã¨ãƒˆãƒ¼ã‚¯ãƒ³å‡¦ç†
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªãƒã‚¸ãƒˆãƒª**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–

### ğŸ”— çµ±åˆãƒ†ã‚¹ãƒˆ (Integration Tests)
- **ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: OAuth2 ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›
- **èªå¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: OpenID Connect èªå¯ãƒ•ãƒ­ãƒ¼
- **Passkeyèªè¨¼**: WebAuthn èªè¨¼å‡¦ç†

### ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ (Security Tests)
- **èªè¨¼æ¤œè¨¼**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **å…¥åŠ›æ¤œè¨¼**: XSSã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒãƒƒã‚·ãƒ¥åŒ–ã¨ã‚½ãƒ«ãƒˆ

## ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### ç’°å¢ƒå¤‰æ•°
ãƒ†ã‚¹ãƒˆã§ã¯ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ã„ã¾ã™ï¼š
- `JWT_SECRET`: JWTç½²åç”¨ã®ç§˜å¯†éµ
- `CLIENT_ID`: ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID
- `CLIENT_SECRET`: ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
- `REDIRECT_URI`: ãƒ†ã‚¹ãƒˆç”¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI

### ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
ãƒ†ã‚¹ãƒˆã§ã¯ä»¥ä¸‹ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼š
- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š
- Mock Passkeyèªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

## ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

- **å…¨ä½“**: 80% ä»¥ä¸Š
- **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹**: 95% ä»¥ä¸Š
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£**: 100%

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ†ã‚¹ãƒˆå‘½åè¦å‰‡
```typescript
Deno.test("Component - should do something when condition", async () => {
  // ãƒ†ã‚¹ãƒˆå†…å®¹
});
```

### ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
```typescript
import { assertEquals, assertNotEquals, assertThrows } from "@std/assert";

// åŸºæœ¬çš„ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
assertEquals(actual, expected);
assertNotEquals(actual, unexpected);

// ä¾‹å¤–ãƒ†ã‚¹ãƒˆ
assertThrows(() => {
  // ä¾‹å¤–ã‚’æŠ•ã’ã‚‹å‡¦ç†
}, Error, "æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸");
```

### éåŒæœŸãƒ†ã‚¹ãƒˆ
```typescript
Deno.test("Async operation", async () => {
  const result = await someAsyncOperation();
  assertEquals(result.success, true);
});
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **æ¨©é™ã‚¨ãƒ©ãƒ¼**: `--allow-all` ãƒ•ãƒ©ã‚°ã‚’ç¢ºèª
2. **KVã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼**: `--unstable-kv` ãƒ•ãƒ©ã‚°ã‚’ç¢ºèª
3. **ç’°å¢ƒå¤‰æ•°**: ãƒ†ã‚¹ãƒˆå†…ã§é©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°
```bash
# ãƒ‡ãƒãƒƒã‚°æƒ…å ±ä»˜ãã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
DEBUG=true deno test --allow-all --unstable-kv

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿ãƒ‡ãƒãƒƒã‚°
deno test tests/unit/infra/jwt.test.ts --allow-all --unstable-kv --inspect-brk
```

## ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š
1. ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚° (`deno task check`)
2. å˜ä½“ãƒ†ã‚¹ãƒˆ (`deno task test`)
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
4. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ